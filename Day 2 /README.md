# Timing libs, hierarchical vs flat synthesis and efficient flop coding styles

#### Lab Steps

##### Introduction to timing .libs

<details>
<summary>Introduction to dot Lib</summary>
<br>

![image](https://github.com/user-attachments/assets/035d7cf3-845b-4185-a30a-528c4d198a30)

## sky130_fd_sc_hd__tt_025c_1v80
### Here tt --> indicates a typical process
### 025c --> temperature
### 1v80 --> voltage that is 1.8 V

![image](https://github.com/user-attachments/assets/fc7d9485-4cac-4079-b400-50bcca7c237d)

## Different types of cells in library

![image](https://github.com/user-attachments/assets/43b4f3e7-5b50-4174-828d-187a2c0641fd)

# Behavioral model of a particular cell

## In the gvim write the command as

:sp /home/comp/sky130RTLDesignAndSynthesisWorkshop/verilog_model/sky130_fd_sc_a2111o_1.behavioral.v

![image](https://github.com/user-attachments/assets/5ebc9c4b-3037-475c-b87c-9763dc740d43)

## Verilog model of 2 input AND Gate

![image](https://github.com/user-attachments/assets/7160414a-e348-471c-8855-82171faa54e9)

## Wider cells are faster but area is going to be more. They also consume more power.

## Smaller cells delay will be more and area will be less

![image](https://github.com/user-attachments/assets/6b204267-0b92-4b7b-b51f-2136a9e67c26)

</details>

# Hierarchical vs Flat Synthesis

<details>
<summary>multiple modules</summary>
<br>

```
module sub_module2 (input a, input b, output y);
	assign y = a | b;
endmodule

module sub_module1 (input a, input b, output y);
	assign y = a&b;
endmodule


module multiple_modules (input a, input b, input c , output y);
	wire net1;
	sub_module1 u1(.a(a),.b(b),.y(net1));  //net1 = a&b
	sub_module2 u2(.a(net1),.b(c),.y(y));  //y = net1|c ,ie y = a&b + c;
endmodule

```

![image](https://github.com/user-attachments/assets/0ad22183-948e-4923-a3fd-2d070bd22bc5)

![image](https://github.com/user-attachments/assets/15f599bb-f513-4e33-bc73-92e9fd5f0f21)

![image](https://github.com/user-attachments/assets/738c581e-3fb1-4fba-9587-951b693bdae4)

### synth -top multiple_modules

![image](https://github.com/user-attachments/assets/6ef0025f-3ccf-4733-81e6-03e04c81779b)


![image](https://github.com/user-attachments/assets/aaf2e579-f9d6-4983-b38a-1b979e2d55ae)


### abc -liberty /home/comp/sky130RTLDesignAndSynthesisWorkshop/lib/sky130_fd_sc_hd__tt_025C_1v80.lib

![image](https://github.com/user-attachments/assets/6f955eae-8829-4501-88b4-51381bfc7963)

### show multiple_modules

![image](https://github.com/user-attachments/assets/72c5c806-c447-4e15-8b4e-51581ff82a70)

### write_verilog multiple_modules_hier.v

![image](https://github.com/user-attachments/assets/ef1981d7-2bb8-4e48-90e6-8a8f1cef7036)

### Hierarchies are preserved

![image](https://github.com/user-attachments/assets/ced43954-0069-4296-bc7f-76e5cfb8c0f0)

```
/* Generated by Yosys 0.46+124 (git sha1 d1695ad99, g++ 9.4.0-1ubuntu1~20.04.2 -fPIC -O3) */

module multiple_modules(a, b, c, y);
  input a;
  wire a;
  input b;
  wire b;
  input c;
  wire c;
  wire net1;
  output y;
  wire y;
  sub_module1 u1 (
	.a(a),
	.b(b),
	.y(net1)
  );
  sub_module2 u2 (
	.a(net1),
	.b(c),
	.y(y)
  );
endmodule

module sub_module1(a, b, y);
  wire _0_;
  wire _1_;
  wire _2_;
  input a;
  wire a;
  input b;
  wire b;
  output y;
  wire y;
  sky130_fd_sc_hd__and2_0 _3_ (
	.A(_1_),
	.B(_0_),
	.X(_2_)
  );
  assign _1_ = b;
  assign _0_ = a;
  assign y = _2_;
endmodule

module sub_module2(a, b, y);
  wire _0_;
  wire _1_;
  wire _2_;
  input a;
  wire a;
  input b;
  wire b;
  output y;
  wire y;
  sky130_fd_sc_hd__or2_0 _3_ (
	.A(_1_),
	.B(_0_),
	.X(_2_)
  );
  assign _1_ = b;
  assign _0_ = a;
  assign y = _2_;
endmodule

```
</details>

<details>
<summary>flatten command</summary>
<br>
	
![image](https://github.com/user-attachments/assets/d2b939ab-68e3-42e7-9e47-8400b1000eae)

### write_verilog -noattr multiple_modules_flat.v

### !gvim  multiple_modules_flat.v

![image](https://github.com/user-attachments/assets/9103fbdc-371e-4900-b516-cf7346792084)

</details>

<details>
<summary>Difference between hierarchical and flat</summary>
<br> 

### In gvim type :vsp multiple_modules_hier.v

![image](https://github.com/user-attachments/assets/867d07dd-64de-4822-bfad-23a7096b1874)

# synthesizing sub module in multiple_modules

## Steps

### read_liberty -lib /home/comp/sky130RTLDesignAndSynthesisWorkshop/lib/sky130_fd_sc_hd__tt_025C_1v80.lib

### read_verilog /home/comp/sky130RTLDesignAndSynthesisWorkshop/verilog_files/multiple_modules.v

### synth -top sub_module1

![image](https://github.com/user-attachments/assets/340b92b7-3ff8-4210-bad4-5b2aa6a5caf5)


![image](https://github.com/user-attachments/assets/67e5644f-0ab5-4b8f-a85a-1216eebdd150)


```
abc -liberty /home/comp/sky130RTLDesignAndSynthesisWorkshop/lib/sky130_fd_sc_hd__tt_025C_1v80.lib

show

```

![image](https://github.com/user-attachments/assets/fd2c519a-f4a9-4203-8aa0-e23bbb495054)

## Why sub module level synthesis?

![image](https://github.com/user-attachments/assets/ed765405-9b4b-425b-9390-844ae30d45a9)

</details>

<details>
<summary>Various Flop Coding Styles and Optimization</summary>

### Why Flops and Flop Coding Styles?

![image](https://github.com/user-attachments/assets/5fa6dbe4-fe02-4a78-b622-6a3f104ee6af)

+ ### Flop is a storage element

+ ### Set/Reset are used to intialize the flop, they can be synchronous/asynchronous

![image](https://github.com/user-attachments/assets/1ec8cf95-8a52-455e-bbd1-6888171adea0)

+ ## Example of flop with asynchronous input

![image](https://github.com/user-attachments/assets/90e81d45-9c8f-4579-a23e-be4ac1ccc5d7)


+ ## Code and hardware with Asynchronous/Synchronous inputs

![image](https://github.com/user-attachments/assets/6d4a6478-54e3-4035-bad7-240bbc51431d)

<details>
<summary>flop synthesis simulations</summary>
<br>
	
## Consider an example of Asynchronous Reset

### Step 1:
![image](https://github.com/user-attachments/assets/74dc92c0-c732-4584-93e2-fccf7a21b84d)

### Step 2:

![image](https://github.com/user-attachments/assets/4fb6e286-816b-4d2c-b8bf-d631dfd4673d)

### Step 3:

![image](https://github.com/user-attachments/assets/d46c05a6-3dcf-4e52-898f-6704f2284961)

</details>

<details>
<summary>example of Asynchronous set</summary>
<br> 

### Step 1:

![image](https://github.com/user-attachments/assets/0dd905df-3ba3-42bc-9eb2-2fb300dfc8f3)

### Step 2:
![image](https://github.com/user-attachments/assets/da4ba326-57a9-453c-a0ff-bc5bcc40e4e5)

### Step 3:

![image](https://github.com/user-attachments/assets/29b95b75-85b1-42fe-a230-51baea8890c2)
![image](https://github.com/user-attachments/assets/a921f31a-eb60-453b-af98-e63e250c966d)

</details>

<details>
<summary>example of synchronous reset</summary>
<br>
	
### Step 1:
![image](https://github.com/user-attachments/assets/f3d07edb-976f-41fd-9685-9c9aa1cd32be)

### Step 2:
![image](https://github.com/user-attachments/assets/dfb24951-38f8-42a8-b026-f4deea24d9c5)

### Step 3:

![image](https://github.com/user-attachments/assets/4a379fb1-0191-404a-ab74-085c7296af1a)

</details>

<details>
<summary>Synthesis of Asynchronous reset/set and Synchronous Set using yosys</summary>
<br>
	
+ ### Step 1: read_liberty -lib /home/comp/sky130RTLDesignAndSynthesisWorkshop/lib/sky130_fd_sc_hd__tt_025C_1v80.lib

+ ### Step 2: read_verilog /home/comp/sky130RTLDesignAndSynthesisWorkshop/verilog_files/dff_asyncres.v

![image](https://github.com/user-attachments/assets/2b0885f4-cda2-45b7-8076-4d4b117525f9)

+ ### Step 3: synth -top dff_asyncres

![image](https://github.com/user-attachments/assets/de7419b3-c0c5-4a55-891e-1cd99e9f79de)

+ ### Step 4: Since we are using D flip-flop use a keyword dfflibmap
### dfflibmap -liberty /home/comp/sky130RTLDesignAndSynthesisWorkshop/lib/sky130_fd_sc_hd__tt_025C_1v80.lib

![image](https://github.com/user-attachments/assets/9cc0122e-dd0e-442c-8b60-e678790e6edb)

+ ### Step 5: abc -liberty /home/comp/sky130RTLDesignAndSynthesisWorkshop/lib/sky130_fd_sc_hd__tt_025C_1v80.lib

![image](https://github.com/user-attachments/assets/413deae9-6b0b-4a75-8af0-a9807293a1df)

+ ### Step 6: show
  
![image](https://github.com/user-attachments/assets/1e512cf4-e666-4d41-923e-bc1ec49bfaaf)

</details>

<details>
<summary>D flip-flop</summary>
<br>
	
## Similar Steps can be followed for D flip-flop asynchronous set

![image](https://github.com/user-attachments/assets/d9b542b3-98d6-4edf-8d76-5b4b6c234d36)

## D flip-flop synchronous reset

![image](https://github.com/user-attachments/assets/f5dbf6ae-c3ab-4144-a9bf-3b950c214fe3)

![image](https://github.com/user-attachments/assets/1172facc-efaf-4b52-b0f0-02f3e51f0504)

</details>

<details>
<summary>interesting optimisations</summary>
<br>

# Consider an example of mult_2.v to understand interesting optimisations

```
module mul2 (input [2:0] a, output [3:0] y);
	assign y = a * 2;
endmodule

```

![image](https://github.com/user-attachments/assets/72084067-4a34-4b6d-9ad1-9e8acf6c3dfe)

![image](https://github.com/user-attachments/assets/f2ae7678-01ce-4f79-85d9-b4d265378db9)

## Synthesis in yosys

![image](https://github.com/user-attachments/assets/88ff775a-eb6f-4d43-a35b-06481bd3795d)

### Not necessary to run abc as number of standard cells are zero

![image](https://github.com/user-attachments/assets/156ad2d6-9ffc-406f-b7a0-c0fdb07a52fd)

![image](https://github.com/user-attachments/assets/44082b82-3de4-4055-b823-2e35edd00d02)

# Consider a special case where y is multiplied with 9

![image](https://github.com/user-attachments/assets/2a3ccf95-d562-49ab-8006-d77682702e16)

```
module mult8 (input [2:0] a , output [5:0] y);
	assign y = a * 9;
endmodule

```
## Do the synthesis in yosys

![image](https://github.com/user-attachments/assets/337535da-43ab-4948-83cb-298f03d3c215)

![image](https://github.com/user-attachments/assets/61cfeab5-8936-4d96-a97f-0e104164a59b)

# Netlist of mult8

![image](https://github.com/user-attachments/assets/6ac0f508-016c-442f-b861-63b3fbba2c63)


![image](https://github.com/user-attachments/assets/2f8f1db0-8d35-4fbb-abbf-19f33af11549)

</details>















